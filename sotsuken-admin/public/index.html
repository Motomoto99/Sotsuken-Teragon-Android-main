<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‹å–¶ç®¡ç†ç”»é¢ - Sotsuken Teragon</title>
    <style>
        /* ãƒªã‚»ãƒƒãƒˆã¨åŸºæœ¬è¨­å®š */
        body { margin: 0; padding: 0; font-family: sans-serif; background-color: #f5f5f5; height: 100vh; display: flex; flex-direction: column; }
        * { box-sizing: border-box; }

        /* ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ç”¨ */
        .login-wrapper { display: flex; justify-content: center; align-items: center; height: 100vh; width: 100%; padding: 20px; }
        .login-box { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        
        /* ç®¡ç†ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .admin-layout { display: flex; height: 100vh; width: 100%; overflow: hidden; position: relative; }
        
        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆPCå‘ã‘ï¼‰ */
        .sidebar { width: 260px; background-color: #2c3e50; color: white; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; transition: transform 0.3s ease; z-index: 1000; }
        .sidebar h2 { font-size: 1.2rem; margin-bottom: 20px; text-align: center; border-bottom: 1px solid #34495e; padding-bottom: 10px; }
        .user-info { font-size: 0.8rem; color: #bdc3c7; margin-bottom: 20px; word-break: break-all; }
        
        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ */
        .nav-btn { background: transparent; border: none; color: #ecf0f1; padding: 15px; text-align: left; cursor: pointer; font-size: 1rem; border-radius: 6px; margin-bottom: 5px; transition: background 0.2s; width: 100%; display: flex; align-items: center; }
        .nav-btn:hover { background-color: #34495e; }
        .nav-btn.active { background-color: #4CAF50; color: white; font-weight: bold; }
        
        /* ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ */
        .logout-btn { margin-top: auto; background-color: #c0392b; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; width: 100%; }
        
        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ */
        .main-content { flex-grow: 1; padding: 20px; overflow-y: auto; background-color: #ecf0f1; width: 100%; }
        .content-section { display: none; animation: fadeIn 0.3s; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* ã‚¹ãƒãƒ›ç”¨ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .mobile-header {
            display: none;
            background-color: #2c3e50;
            color: white;
            height: 60px;
            position: relative;
            align-items: center;
            justify-content: center;
            width: 100%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        button.menu-toggle {
            position: absolute !important;
            left: 15px !important;
            top: 50% !important;
            transform: translateY(-50%);
            background: none !important;
            border: none !important;
            color: white !important;
            font-size: 28px !important;
            cursor: pointer;
            padding: 0 !important;
            margin: 0 !important;
            z-index: 20;
            width: auto !important;
            height: auto !important;
            line-height: 1;
        }

        .mobile-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 0;
            pointer-events: none;
        }

        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å†…ã®ãƒ‘ãƒ¼ãƒ„ */
        h1 { margin-top: 0; color: #2c3e50; border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-bottom: 20px; font-size: 1.5rem; }
        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        input, textarea, button { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
        button.action-btn { background-color: #4CAF50; color: white; border: none; cursor: pointer; font-weight: bold; width: auto; padding: 10px 20px; min-width: 100px; }
        
        .item-row { border-bottom: 1px solid #eee; padding: 15px 0; display: flex; justify-content: space-between; align-items: flex-start; }
        
        .delete-btn { background-color: #ff9800; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; width: auto; font-size: 0.9rem; white-space: nowrap; margin-left: 10px; }
        .delete-btn:hover { background-color: #f57c00; }

        .error-msg { color: red; font-weight: bold; margin-bottom: 10px; display: none; }

        /* ç”»åƒãªã© */
        .content-flex { display: flex; align-items: flex-start; flex-grow: 1; }
        .thumbnail-image { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; margin-right: 10px; background-color: #eee; flex-shrink: 0; }
        .user-icon { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin-right: 10px; background-color: #eee; border: 1px solid #ccc; flex-shrink: 0; }
        .no-image { display: flex; align-items: center; justify-content: center; color: #999; font-size: 10px; text-align: center;}
        .sub-text { font-size: 0.85rem; color: #666; word-break: break-all; }

        /* ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 900; }

        @media (max-width: 768px) {
            .admin-layout { flex-direction: column; }
            
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                width: 250px;
                transform: translateX(-100%);
                box-shadow: 2px 0 5px rgba(0,0,0,0.2);
            }
            
            .sidebar.open { transform: translateX(0); }
            .overlay.open { display: block; }
            .mobile-header { display: flex; }
            .main-content { padding: 15px; padding-bottom: 80px; }
            h1 { font-size: 1.3rem; }
            .container { padding: 15px; }
            button.action-btn { width: 100%; padding: 15px; }
            .delete-btn { padding: 10px; }
        }
    </style>
</head>
<body>

    <div id="login-section" class="login-wrapper">
        <div class="login-box">
            <h2>é‹å–¶ç®¡ç†ãƒ‘ãƒãƒ«</h2>
            <p class="error-msg" id="auth-error"></p>
            <input type="email" id="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹">
            <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
            <button class="action-btn" style="width:100%" onclick="login()">ãƒ­ã‚°ã‚¤ãƒ³</button>
        </div>
    </div>

    <div id="admin-panel" class="admin-layout" style="display:none;">
        
        <header class="mobile-header">
            <button class="menu-toggle" onclick="toggleMenu()">&#9776;</button>
            <span class="mobile-title">Sotsuken Admin</span>
        </header>

        <div class="overlay" onclick="toggleMenu()"></div>

        <nav class="sidebar" id="sidebar">
            <h2>Sotsuken Admin</h2>
            <div class="user-info">Login: <span id="current-user-email"></span></div>
            
            <button class="nav-btn active" onclick="switchTab('notification', this)">ğŸ“¢ ãŠçŸ¥ã‚‰ã›é…ä¿¡</button>
            <button class="nav-btn" onclick="switchTab('users', this)">ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</button>
            <button class="nav-btn" onclick="switchTab('posts', this)">ğŸ½ï¸ æŠ•ç¨¿ç®¡ç†</button>
            
            <button class="logout-btn" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </nav>

        <main class="main-content">

            <div id="tab-notification" class="content-section active">
                <h1>ãŠçŸ¥ã‚‰ã›é…ä¿¡</h1>
                <div class="container">
                    <p>å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã€Œé‹å–¶ã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›ã€ã«é€šçŸ¥ã‚’é€ã‚Šã¾ã™ã€‚</p>
                    <input type="text" id="notif-title" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä¾‹ï¼šãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ãŠçŸ¥ã‚‰ã›ï¼‰" value="é‹å–¶ã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›">
                    <textarea id="notif-content" rows="5" placeholder="æœ¬æ–‡ï¼ˆä¾‹ï¼šæ˜æ—¥12æ™‚ã‹ã‚‰ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’è¡Œã„ã¾ã™ã€‚ï¼‰"></textarea>
                    <button class="action-btn" onclick="sendNotification()">é…ä¿¡ã™ã‚‹</button>
                </div>

                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; margin-top:30px;">
                    <h2 style="margin:0; font-size:1.2rem; border:none;">é€ä¿¡å±¥æ­´ï¼ˆæœ€æ–°20ä»¶ï¼‰</h2>
                    <button class="action-btn" style="background-color:#FF9800; width:auto;" onclick="loadNotificationHistory()">æ›´æ–°</button>
                </div>
                <div class="container" style="padding:0;">
                    <div id="notification-history-list" style="padding:15px;">å±¥æ­´ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„...</div>
                </div>
            </div>

            <div id="tab-users" class="content-section">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; flex-wrap:wrap; gap:10px;">
                    <h1 style="margin:0; border:none;">ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</h1>
                    <button class="action-btn" style="background-color:#FF9800; width:auto;" onclick="loadUsers()">æ›´æ–°</button>
                </div>
                <div class="container" style="padding:0;">
                    <div id="users-list" style="padding:15px;">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„...</div>
                </div>
            </div>

            <div id="tab-posts" class="content-section">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; flex-wrap:wrap; gap:10px;">
                    <h1 style="margin:0; border:none;">ã¿ã‚“ãªã®æŠ•ç¨¿ç®¡ç†</h1>
                    <button class="action-btn" style="background-color:#2196F3; width:auto;" onclick="loadPosts()">æ›´æ–°</button>
                </div>
                <div class="container" style="padding:0;">
                    <div style="padding:15px; border-bottom:1px solid #eee;">
                        <small>æœ€æ–°20ä»¶ã®å…¬é–‹æŠ•ç¨¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</small>
                    </div>
                    <div id="posts-list" style="padding:15px;">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„...</div>
                </div>
            </div>

        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        // â˜… getDoc ã‚’è¿½åŠ ã—ã¾ã—ãŸ â˜…
        import { getFirestore, collection, addDoc, serverTimestamp, getDocs, query, orderBy, limit, deleteDoc, updateDoc, getDoc, doc, where, collectionGroup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // â˜…è¨­å®šæƒ…å ±
        const firebaseConfig = {
          apiKey: "AIzaSyD474cBefVF_S5TCYHcDAyeeZu34z_9KkI",
          authDomain: "sotugyo-kenkyu-a0e36.firebaseapp.com",
          projectId: "sotugyo-kenkyu-a0e36",
          storageBucket: "sotugyo-kenkyu-a0e36.firebasestorage.app",
          messagingSenderId: "212042452857",
          appId: "1:212042452857:web:c7dc60ec96bddebb05e9a8"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const ADMIN_EMAIL = "test@a.aa";

        window.toggleMenu = () => {
            document.getElementById('sidebar').classList.toggle('open');
            document.querySelector('.overlay').classList.toggle('open');
        };

        window.switchTab = (tabId, btnElement) => {
            document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            if(btnElement) btnElement.classList.add('active');

            if(window.innerWidth <= 768) { toggleMenu(); }

            if(tabId === 'users') loadUsers();
            if(tabId === 'posts') loadPosts();
        };

        onAuthStateChanged(auth, (user) => {
            const errorMsg = document.getElementById('auth-error');
            if (user) {
                if (user.email === ADMIN_EMAIL) {
                    document.getElementById('login-section').style.display = 'none';
                    document.getElementById('admin-panel').style.display = 'flex';
                    document.getElementById('current-user-email').textContent = user.email;
                    errorMsg.style.display = 'none';
                } else {
                    signOut(auth).then(() => {
                        errorMsg.textContent = "ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã¯ç®¡ç†è€…æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
                        errorMsg.style.display = 'block';
                    });
                }
            } else {
                document.getElementById('login-section').style.display = 'flex';
                document.getElementById('admin-panel').style.display = 'none';
            }
        });

        window.login = async () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorMsg = document.getElementById('auth-error');
            errorMsg.style.display = 'none';
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                errorMsg.textContent = "ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—: " + error.message;
                errorMsg.style.display = 'block';
            }
        };

        window.logout = () => signOut(auth);

        window.sendNotification = async () => {
            const title = document.getElementById('notif-title').value;
            const content = document.getElementById('notif-content').value;
            if (!content) return alert("æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            if(!confirm("å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã™ã‹ï¼Ÿ")) return;
            try {
                await addDoc(collection(db, "notifications"), {
                    title: title, content: content, date: serverTimestamp()
                });
                alert("é€ä¿¡ã—ã¾ã—ãŸï¼");
                document.getElementById('notif-content').value = "";
            } catch (e) { alert("é€ä¿¡ã‚¨ãƒ©ãƒ¼: " + e.message); }
        };

        window.loadUsers = async () => {
            const listDiv = document.getElementById('users-list');
            listDiv.innerHTML = "èª­ã¿è¾¼ã¿ä¸­...";
            try {
                const q = query(collection(db, "users"), limit(50));
                const querySnapshot = await getDocs(q);
                listDiv.innerHTML = "";
                const countDiv = document.createElement('div');
                countDiv.style.padding = "0 15px 15px 15px";
                countDiv.style.fontWeight = "bold";
                countDiv.innerHTML = `ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: ${querySnapshot.size}äºº (æœ€å¤§50ä»¶)`;
                listDiv.appendChild(countDiv);

                querySnapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    const div = document.createElement('div');
                    div.className = "item-row";
                    let iconTag = `<div class="user-icon no-image">No Img</div>`;
                    if (data.photoUrl) { iconTag = `<img src="${data.photoUrl}" class="user-icon">`; }
                    let lastSeen = "---";
                    if (data.lastSeenNotificationDate) {
                        lastSeen = new Date(data.lastSeenNotificationDate.seconds * 1000).toLocaleString();
                    }
                    div.innerHTML = `
                        <div class="content-flex">
                            ${iconTag}
                            <div style="min-width:0;">
                                <strong>${data.username || "åç§°æœªè¨­å®š"}</strong><br>
                                <span class="sub-text" style="font-size:0.75rem;">UID: ${docSnap.id}</span><br>
                                <span class="sub-text">æœ€çµ‚: ${lastSeen}</span>
                            </div>
                        </div>
                    `;
                    listDiv.appendChild(div);
                });
            } catch (e) {
                console.error(e);
                listDiv.innerHTML = "èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: " + e.message;
            }
        };

        // â˜…è¿½åŠ : ãŠçŸ¥ã‚‰ã›å±¥æ­´ã®èª­ã¿è¾¼ã¿
window.loadNotificationHistory = async () => {
    const listDiv = document.getElementById('notification-history-list');
    listDiv.innerHTML = "èª­ã¿è¾¼ã¿ä¸­...";
    try {
        // æ—¥ä»˜ã®æ–°ã—ã„é †ã«20ä»¶å–å¾—
        const q = query(collection(db, "notifications"), orderBy("date", "desc"), limit(20));
        const querySnapshot = await getDocs(q);

        listDiv.innerHTML = "";
        if (querySnapshot.empty) {
            listDiv.innerHTML = "é€ä¿¡å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚";
            return;
        }

        querySnapshot.forEach((docSnap) => {
            const data = docSnap.data();
            const div = document.createElement('div');
            div.className = "item-row";

            let dateStr = "æ—¥æ™‚ä¸æ˜";
            if(data.date) { dateStr = new Date(data.date.seconds * 1000).toLocaleString(); }

            div.innerHTML = `
                <div class="content-flex">
                    <div style="min-width:0;">
                        <strong>${data.title}</strong><br>
                        <span class="sub-text">${dateStr}</span><br>
                        <p style="margin:5px 0 0 0; font-size:0.9rem; white-space: pre-wrap; color:#333;">${data.content}</p>
                    </div>
                </div>
                <button class="delete-btn" onclick="deleteNotification('${docSnap.id}')">å‰Šé™¤</button>
            `;
            listDiv.appendChild(div);
        });
    } catch (e) {
        console.error(e);
        listDiv.innerHTML = "èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: " + e.message;
    }
};

// â˜…è¿½åŠ : ãŠçŸ¥ã‚‰ã›ã®å‰Šé™¤
window.deleteNotification = async (id) => {
    if(!confirm("ã“ã®ãŠçŸ¥ã‚‰ã›ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ãƒ—ãƒªã‹ã‚‰ã‚‚æ¶ˆãˆã¾ã™ï¼‰")) return;
    try {
        await deleteDoc(doc(db, "notifications", id));
        alert("å‰Šé™¤ã—ã¾ã—ãŸ");
        loadNotificationHistory(); // ãƒªã‚¹ãƒˆã‚’å†èª­ã¿è¾¼ã¿
    } catch(e) {
        alert("å‰Šé™¤ã‚¨ãƒ©ãƒ¼: " + e.message);
    }
};

        window.loadPosts = async () => {
            const listDiv = document.getElementById('posts-list');
            listDiv.innerHTML = "èª­ã¿è¾¼ã¿ä¸­...";
            try {
                const q = query(
                    collectionGroup(db, "my_records"),
                    where("isPublic", "==", true),
                    orderBy("date", "desc"),
                    limit(20)
                );
                const querySnapshot = await getDocs(q);
                listDiv.innerHTML = "";
                if (querySnapshot.empty) {
                    listDiv.innerHTML = "å…¬é–‹ã•ã‚ŒãŸæŠ•ç¨¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚";
                    return;
                }
                querySnapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    const div = document.createElement('div');
                    div.className = "item-row";
                    let dateStr = "æ—¥æ™‚ä¸æ˜";
                    if(data.date) { dateStr = new Date(data.date.seconds * 1000).toLocaleString(); }
                    let imgTag;
                    if (data.imageUrl) { imgTag = `<img src="${data.imageUrl}" class="thumbnail-image">`; } 
                    else { imgTag = `<div class="thumbnail-image no-image">No Image</div>`; }

                    div.innerHTML = `
                        <div class="content-flex">
                            ${imgTag}
                            <div style="min-width:0;">
                                <strong>${data.menuName || "æ–™ç†åãªã—"}</strong><br>
                                <span class="sub-text">${dateStr}</span><br>
                                <span class="sub-text">${data.memo || ""}</span>
                            </div>
                        </div>
                        <button class="delete-btn" onclick="deletePost('${docSnap.ref.path}')">éå…¬é–‹</button>
                    `;
                    listDiv.appendChild(div);
                });
            } catch (e) {
                console.error(e);
                listDiv.innerHTML = "èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼";
            }
        };

        // â˜…â˜…â˜… æŠ•ç¨¿ã‚’éå…¬é–‹ã«ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ã‚’é€ã‚‹å‡¦ç† â˜…â˜…â˜…
        window.deletePost = async (path) => {
            if(!confirm("ã“ã®æŠ•ç¨¿ã‚’å¼·åˆ¶çš„ã«éå…¬é–‹ã«ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã¾ã™ï¼‰")) return;
            
            try {
                const pathSegments = path.split('/');
                // path: users/{uid}/my_records/{docId}
                const uid = pathSegments[1];
                const docRef = doc(db, pathSegments[0], pathSegments[1], pathSegments[2], pathSegments[3]);

                // 1. æ–™ç†åã‚’å–å¾—ï¼ˆé€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ï¼‰
                const snap = await getDoc(docRef);
                const menuName = snap.exists() ? snap.data().menuName : "è¨˜éŒ²";

                // 2. æŠ•ç¨¿ã‚’éå…¬é–‹ã«ã™ã‚‹
                await updateDoc(docRef, { isPublic: false });

                // 3. ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ã‚’é€ã‚‹
                await addDoc(collection(db, "users", uid, "notifications"), {
                    title: "æŠ•ç¨¿ã«é–¢ã™ã‚‹ãŠçŸ¥ã‚‰ã›",
                    content: `ã‚ãªãŸã®è¨˜éŒ²ã€Œ${menuName}ã€ã¯ã€é‹å–¶ã«ã‚ˆã£ã¦éå…¬é–‹ã«è¨­å®šã•ã‚Œã¾ã—ãŸã€‚`,
                    date: serverTimestamp()
                });
                
                alert("éå…¬é–‹ã«ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ã—ã¾ã—ãŸã€‚");
                loadPosts(); // ãƒªã‚¹ãƒˆæ›´æ–°
            } catch(e) { 
                alert("å‡¦ç†å¤±æ•—: " + e.message); 
            }
        };
    </script>
</body>
</html>